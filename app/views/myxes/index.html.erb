<script>
  $( ".myxes" ).ready(function() {
    $( ".myxes" ).fadeIn( "medium" );
  });
</script>

<% data = HTTParty.get('http://www.instagram.com/textsfromyourex/?__a=1') %>
<% data = data.body %>
<% data = JSON.parse(data) %>
<% @data = data["graphql"]["user"]["edge_owner_to_timeline_media"]["edges"] %>
  
  <% if user_signed_in? %>
    <%= render partial: 'new' %>
  <% end %>
  <br />
  
  <div class="mb-2 container w-2/3 mx-auto text-2xl text-teal-800 font-bold">
    Whats new?
  </div>

  <% @myx.each_with_index do |myx, index| %>
    <div class="myxes container w-2/3 pt-6 pl-10 pr-10 pb-8 mx-auto bg-white bg-opacity-75 border-solid border border-gray-400 rounded">
      <div class="text-teal-800 text-sm font-bold mb-2">
        <%= link_to user_path(myx.user.id) do %>
          <%= myx.user.username %>
        <% end %>
      </div>
      <div class="text-sm text-gray-700 pl-4">
        <%= myx.message %>
      </div>
    </div>
    <br />
    <% if index % 3 == 0 %>
      <% data = @data[index] %>
      <div class="myxes container w-2/3 pt-6 pl-10 pr-10 pb-8 mx-auto bg-white bg-opacity-75 border-solid border border-gray-400 rounded">
        <div class="text-teal-800 text-sm font-bold mb-2">
          <%= link_to 'https://instagram.com/textsfromyourex', target: '_blank' do %>
            textsfromyourex 
            <div class="font-normal text-black text-xs">via instagram</div>
          <% end %>
        </div>
        <img class="mx-auto w-1/2" src="<%= data["node"]["display_url"] %>">
      </div>
      <br />
    <% end %>
  <% end %>

  